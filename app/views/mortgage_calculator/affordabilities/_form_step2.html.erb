<%= form_for @affordability, builder: Dough::Forms::Builders::Validation, url: step_3_affordability_path, html: { name: 'affordability_form', role: 'form' } do |f| %>
  <% @affordability.people.each_with_index do |person, index| %>
    <%= hidden_field_tag "affordability[people_attributes][#{index}][annual_income]", person.annual_income.to_s %>
    <%= hidden_field_tag "affordability[people_attributes][#{index}][extra_income]", person.extra_income.to_s %>
    <%= hidden_field_tag "affordability[people_attributes][#{index}][monthly_net_income]", person.monthly_net_income.to_s %>
  <% end %>

  <% f.validates @affordability, @affordability.outgoings %>

  <%= f.validation_summary %>

  <!-- OUTGOING FIELDS -->
  <p><strong><%= I18n.t("affordability.titles.monthly_outgoings") %></strong></p>
  <p><%= I18n.t("affordability.input_page.monthly_outgoings_descriptions") %></p>

  <%= f.fields_for :outgoings, @affordability.outgoings do |outgoings| %>
    <p><%= I18n.t("affordability.titles.estimated_committed") %></p>
    <div class="mortgagecalc__panel">
      <div>
        <%= outgoings.errors_for outgoings.object, :credit_repayments %>
        <%= outgoings.label :credit_repayments, 'Credit card / loan repayments' %>
        <%= outgoings.text_field :credit_repayments,
                              "class" => "form-control",
                              "placeholder" => "Credit debts",
                              "ng-model" => "affordability.outgoings.committed.credit_repayments",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.credit_repayments_formatted %>
      </div>
    </div>

    <div class="mortgagecalc__panel mortgagecalc__panel--with-form">
      <div>
        <%= outgoings.errors_for outgoings.object, :child_maintenance %>
        <%= outgoings.label :child_maintenance, 'Child maintenance / Alimony' %>
        <%= outgoings.text_field :child_maintenance,
                              "class" => "form-control",
                              "placeholder" => "utilities",
                              "ng-model" => "affordability.outgoings.committed.child_maintenance",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.child_maintenance_formatted %>
      </div>
    </div>

    <p class="cf"><%= I18n.t("affordability.titles.estimated_fixed") %></p>
    <div class="mortgagecalc__panel">
      <div>
        <%= outgoings.errors_for outgoings.object, :childcare %>
        <%= outgoings.label :childcare, 'Childcare costs / School fees' %>
        <%= outgoings.text_field :childcare,
                              "class" => "form-control",
                              "placeholder" => "utilities",
                              "ng-model" => "affordability.outgoings.fixed.childcare",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.childcare_formatted %>

        <%= outgoings.errors_for outgoings.object, :travel %>
        <%= outgoings.label :travel, 'Travel / Commuting' %>
        <%= outgoings.text_field :travel,
                              "class" => "form-control",
                              "placeholder" => "Credit debts",
                              "ng-model" => "affordability.outgoings.fixed.travel",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.travel_formatted %>
      </div>
    </div>
    <div class="mortgagecalc__panel mortgagecalc__panel--with-form">
      <div>
        <%= outgoings.errors_for outgoings.object, :utilities %>
        <%= outgoings.label :utilities, 'Bills & insurance' %>
        <%= outgoings.text_field :utilities,
                              "class" => "form-control",
                              "placeholder" => "utilities",
                              "ng-model" => "affordability.outgoings.fixed.utilities",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.utilities_formatted %>

        <%= outgoings.errors_for outgoings.object, :rent_and_mortgage %>
        <%= outgoings.label :rent_and_mortgage, 'Rent / mortgage repayments' %>
        <%= outgoings.text_field :rent_and_mortgage,
                              "class" => "form-control",
                              "placeholder" => "utilities",
                              "ng-model" => "affordability.outgoings.fixed.rent_and_mortgage",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.rent_and_mortgage_formatted %>
      </div>
    </div>

    <p class="cf"><%= I18n.t("affordability.titles.estimated_lifestyle") %></p>
    <div class="mortgagecalc__panel">
      <div>

        <%= outgoings.errors_for outgoings.object, :entertainment %>
        <%= outgoings.label :entertainment, 'Entertainment & leasure' %>
        <%= outgoings.text_field :entertainment,
                              "class" => "form-control",
                              "placeholder" => "Credit debts",
                              "ng-model" => "affordability.outgoings.lifestyle.entertainment",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.entertainment_formatted %>

        <%= outgoings.errors_for outgoings.object, :holidays %>
        <%= outgoings.label :holidays %>
        <%= outgoings.text_field :holidays,
                              "class" => "form-control",
                              "placeholder" => "Credit debts",
                              "ng-model" => "affordability.outgoings.lifestyle.holidays",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.holidays_formatted %>
      </div>
    </div>
    <div class="mortgagecalc__panel mortgagecalc__panel--with-form">
      <div>
        <%= outgoings.errors_for outgoings.object, :food %>
        <%= outgoings.label :food, 'Food, groceries, toileteries' %>
        <%= outgoings.text_field :food,
                              "class" => "form-control",
                              "placeholder" => "Credit debts",
                              "ng-model" => "affordability.outgoings.lifestyle.food",
                              "currency" => '',
                              "data-a-sign" =>"£",
                              "data-m-dec" =>"0",
                              "value" => outgoings.object.food_formatted %>
      </div>
    </div>
  <% end %>
  <!-- END OUTGOING FIELDS -->

  <div class="mortgagecalc__panel mortgagecalc__panel--with-form">
    <%= f.submit I18n.t("affordability.input_page.submit"),
             class: "button button--primary mortgagecalc__submit",
             'ng-click' => 'navigateAndFocus($event); calculateRepayments()' %>
  </div>
<% end %>
