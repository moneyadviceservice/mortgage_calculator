<%= render 'header' %>

<div ng-controller="CalculatorCtrl">
  <%= form_for @affordability, url: affordability_path, html: { name: 'affordability_form', role: 'form' } do |f| %>
    <%= field_set_tag I18n.t("affordability.titles.annual_income") do %>
      <%= f.fields_for :people do |person| %>
        <% count = @affordability.people.find_index(person.object) %>

        <%= person.label :annual_income  %>
        <%= person.text_field :annual_income,
                              "class" => "form-control",
                              "ng-model" => "affordability.earnings.person#{count + 1}.annual",
                              "placeholder" => "Your yearly income",
                              "format" => 'number' %>

        <p ng-show="affordability_form['affordability[people_attributes][<%= count %>][annual_income]'].$invalid && !affordability_form['affordability[people_attributes][<%= count %>][annual_income]'].$pristine" class="help-block">Please enter an amount</p>

        <%= person.label :extra_income  %>
        <%= person.text_field :extra_income,
                              "class" => "form-control",
                              "ng-model" => "affordability.earnings.person#{count + 1}.extra",
                              "placeholder" => "Any extra income",
                              "format" => 'number' %>
      <% end %>
    <% end %>

    <%= field_set_tag I18n.t("affordability.titles.take_home") do %>
      <%= f.fields_for :people do |person| %>
        <% count = @affordability.people.find_index(person.object) %>
        <p ng-show="affordability_form['affordability[people_attributes][<%= count %>][extra_income]'].$invalid && !affordability_form['affordability[people_attributes][<%= count %>][extra_income]'].$pristine" class="help-block">Please enter an amount</p>

        <%= person.label :monthly_net_income  %>
        <%= person.text_field :monthly_net_income,
                              "class" => "form-control",
                              "placeholder" => "Monthly Net Income",
                              "format" => 'number' %>
      <% end %>
    <% end %>

    <%= field_set_tag I18n.t("affordability.titles.monthly_outgoings") do %>
      <p>
        <%= I18n.t("affordability.input_page.monthly_outgoings_descriptions") %>
      </p>
      <%= f.fields_for :outgoings, @affordability.outgoings do |outgoings| %>
        <%= field_set_tag I18n.t("affordability.titles.estimated_committed") do %>
          <%= outgoings.label :credit_repayments %>
          <%= outgoings.text_field :credit_repayments,
                                "class" => "form-control",
                                "placeholder" => "Credit debts",
                                "format" => 'number' %>

          <%= outgoings.label :utilities %>
          <%= outgoings.text_field :utilities,
                                "class" => "form-control",
                                "placeholder" => "utilities",
                                "format" => 'number' %>

          <%= outgoings.label :childcare %>
          <%= outgoings.text_field :childcare,
                                "class" => "form-control",
                                "placeholder" => "utilities",
                                "format" => 'number' %>

          <%= outgoings.label :child_maintenance %>
          <%= outgoings.text_field :child_maintenance,
                                "class" => "form-control",
                                "placeholder" => "utilities",
                                "format" => 'number' %>

          <%= outgoings.label :rent_and_mortgage %>
          <%= outgoings.text_field :rent_and_mortgage,
                                "class" => "form-control",
                                "placeholder" => "utilities",
                                "format" => 'number' %>
        <% end %>

        <%= field_set_tag I18n.t("affordability.titles.estimated_lifestyle") do %>
          <%= outgoings.label :food %>
          <%= outgoings.text_field :food,
                                "class" => "form-control",
                                "placeholder" => "Credit debts",
                                "format" => 'number' %>

          <%= outgoings.label :travel %>
          <%= outgoings.text_field :travel,
                                "class" => "form-control",
                                "placeholder" => "Credit debts",
                                "format" => 'number' %>

          <%= outgoings.label :entertainment %>
          <%= outgoings.text_field :entertainment,
                                "class" => "form-control",
                                "placeholder" => "Credit debts",
                                "format" => 'number' %>
        <% end %>
      <% end %>
    <% end %>

    <%= f.submit I18n.t("affordability.input_page.submit"),
                 class: "button button--primary" %>
  <% end %>

  <div ng-show="affordability.earnings.person1.annual">
    <p class="results">
      Based on your total income of
      <span class='label label-primary'>{{ affordability.totalIncome() | currency:"£" }}</span>
      and your total expenditure of
      <span class='label label-danger'>{{ affordability.personalSpend | currency:"£" }}</span>,
      the maximum mortgage you can borrow is between
      <span class='label label-success'>{{ affordability.minimumBorrowing() | currency:"£" }}</span>
      to
      <span class='label label-success'>{{ affordability.maximumBorrowing() | currency:"£" }}</span>
    </p>
  </div>
</div>

<%= zendesk_feedback_tab(zendesk_affordability_config) %>
