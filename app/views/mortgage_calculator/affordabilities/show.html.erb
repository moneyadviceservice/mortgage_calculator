<div ng-controller="CalculatorCtrl">
  <h1>Find out how much you can borrow</h1>
    <%= form_for @affordability, url: affordability_path, html: { name: 'affordability_form', role: 'form' } do |f| %>
      <!-- START AFFORDABILITY CALCULATOR -->

      <%= field_set_tag do %>
        <label for="person1AnnualIncome">
          Annual Income
          </label>
        <input type="text" ng-pattern="/^\d+$/" name="person1AnnualIncome" class="form-control" ng-model="affordability.earnings.person1.annual" placeholder="Your yearly income" required autofocus />
        <p ng-show="affordability_form.person1AnnualIncome.$invalid && !affordability_form.person1AnnualIncome.$pristine" class="help-block">Please enter an amount</p>
      <% end %>

      <%= field_set_tag do %>
        <label for="person1ExtraIncome">
          Extra Income
        </label>
        <input type="text" ng-pattern="/^\d+$/" class="form-control" name="person1ExtraIncome" ng-model="affordability.earnings.person1.extra" placeholder="Any extra income"  />
        <p ng-show="affordability_form.person1ExtraIncome.$invalid && !affordability_form.person1ExtraIncome.$pristine" class="help-block">Only numbers</p>
      <% end %>

      <div ng-show="affordability.selectedOption == 2">
      <%= field_set_tag do %>
          <label for="person2AnnualIncome">
            Person 2 Annual Income
          </label>
          <input type="text" ng-pattern="/^\d+$/" name="person2AnnualIncome" class="form-control" ng-model="affordability.earnings.person2.annual" placeholder="Your yearly income"  autofocus />
          <p ng-show="affordability_form.person2AnnualIncome.$invalid && !affordability_form.person2AnnualIncome.$pristine" class="help-block">Please enter an amount</p>
        <% end %>

      <%= field_set_tag do %>
          <label for="person2ExtraIncome">
            Person 2 Extra Income
          </label>
          <input type="text" ng-pattern="/^\d+$/" class="form-control" name="person2ExtraIncome" ng-model="affordability.earnings.person2.extra" placeholder="Any extra income"  />
          <p ng-show="affordability_form.person2ExtraIncome.$invalid && !affordability_form.person2ExtraIncome.$pristine" class="help-block">Only numbers</p>
        <% end %>
      </div>

      <%= field_set_tag do %>
        <label for="numberOfPeople">
          Number of people
        </label>
        <select ng-change="normalizeValues()" ng-options="i for i in affordability.numberOfPeople " ng-model="affordability.selectedOption" name="numberOfPeople" class="form-control" required></select>
      <% end %>

      <%= field_set_tag do %>
        <%= f.label :monthly_debt, 'Personal Spend' %>
        <%= f.text_field :monthly_debt, "ng-patern" => "/^\d+$/",
                                        "class" => "form-control",
                                        "ng-model" => "affordability.committedSpend",
                                        "placeholder" => "Spending" %>
        <p ng-show="affordability_form.committedSpend.$invalid && affordability_form.committedSpend.$dirty" class="help-block">Only numbers</p>
      <% end %>

    <!-- END AFFORDABILITY CALCULATOR -->

  <% end %>

  <div ng-show="affordability.earnings.person1.annual">
    <p>
      Based on your total income of
      <span class='label label-primary'>{{ affordability.totalIncome() | currency:"£" }}</span>
      and your total expenditure of
      <span class='label label-danger'>{{ affordability.committedSpend | currency:"£" }}</span>,
      the maximum mortgage you can borrow is between
      <span class='label label-success'>{{ affordability.minimumBorrowing() | currency:"£" }}</span>
      to
      <span class='label label-success'>{{ affordability.maximumBorrowing() | currency:"£" }}</span>
    </p>
  </div>
</div>
